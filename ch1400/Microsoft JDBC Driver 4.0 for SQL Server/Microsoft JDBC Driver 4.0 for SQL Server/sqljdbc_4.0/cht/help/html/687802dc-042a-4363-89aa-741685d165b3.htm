<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>使用 Kerberos 整合式驗證連接到 SQL Server</title><meta name="Language" content="zh-cht" /><meta name="Microsoft.Help.Id" content="687802dc-042a-4363-89aa-741685d165b3" /><meta name="Description" content="從 Microsoft JDBC Driver 4.0 for SQL Server 開始，應用程式可以使用 authenticationScheme 連接屬性來表示它想要使用類型 4 Kerberos 整合式驗證連接到資料庫。如需有關連接屬性的詳細資訊，請參閱＜Setting the Connection Properties＞。如需有關 Kerberos 的詳細資訊，請參閱適用於 Windows 的 Kerberos 技術增補http://go.microsoft." /><meta name="Microsoft.Help.ContentType" content="Concepts" /><link rel="stylesheet" type="text/css" href="../local/Classic.css" /><script type="text/javascript" src="../scripts/EventUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/SplitScreen.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/Dropdown.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_manifold.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_feedBack.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CheckboxMenu.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CommonUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../local/script_main.js">&amp;nbsp;</script></head><body><div id="header"><table id="bottomTable" cellpadding="0" cellspacing="0"><tr><td align="left"><span id="headerBold">使用 Kerberos 整合式驗證連接到 SQL Server</span></td></tr></table><table id="gradientTable"><tr><td class="nsrBottom" background="../icons/gradient.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><div class="introduction"><p>從 Microsoft JDBC Driver 4.0 for SQL Server 開始，應用程式可以使用 <span sdata="langKeyword" value="authenticationScheme"><span class="keyword">authenticationScheme</span></span> 連接屬性來表示它想要使用類型 4 Kerberos 整合式驗證連接到資料庫。如需有關連接屬性的詳細資訊，請參閱＜<span sdata="link"><a href="f1b62700-f046-488d-bd6b-a5cd8fc345b7.htm">設定連接屬性</a></span>＞。如需有關 Kerberos 的詳細資訊，請參閱<a href="http://go.microsoft.com/fwlink/?LinkId=101449">適用於 Windows 的 Kerberos 技術增補</a>和 <a href="http://go.microsoft.com/fwlink/?LinkID=100758">Microsoft Kerberos</a>。</p><p>搭配 Java <span sdata="langKeyword" value="Krb5LoginModule"><span class="keyword">Krb5LoginModule</span></span> 使用整合式驗證時，您可以使用 <a href="http://download.oracle.com/javase/1.5.0/docs/guide/security/jaas/spec/com/sun/security/auth/module/Krb5LoginModule.html">Class Krb5LoginModule</a> 設定模組。</p><p>Microsoft JDBC Driver for SQL Server 會針對 IBM Java VM 設定以下屬性：</p><ul><li><p><span sdata="langKeyword" value="useDefaultCcache = true"><span class="keyword">useDefaultCcache = true</span></span></p></li><li><p><span sdata="langKeyword" value="moduleBanner = false"><span class="keyword">moduleBanner = false</span></span></p></li></ul><p>Microsoft JDBC Driver for SQL Server 會針對所有其他 Java VM 設定以下屬性：</p><ul><li><p><span sdata="langKeyword" value="useTicketCache = true"><span class="keyword">useTicketCache = true</span></span></p></li><li><p><span sdata="langKeyword" value="doNotPrompt = true"><span class="keyword">doNotPrompt = true</span></span></p></li></ul></div><h1 class="heading">備註</h1><div id="sectionSection0" class="section" name="collapseableSection" style=""><p>在 Microsoft JDBC Driver 4.0 for SQL Server 之前，應用程式可以利用 <span sdata="langKeyword" value="integratedSecurity"><span class="keyword">integratedSecurity</span></span> 連接屬性及參考 <span sdata="langKeyword" value="sqljdbc_auth.dll"><span class="keyword">sqljdbc_auth.dll</span></span> 來指定整合式驗證 (使用 Kerberos 或 NTLM，取決於哪一個為可用狀態)，如＜<span sdata="link"><a href="44996746-d373-4f59-9863-a8a20bb8024a.htm">建立連接 URL</a></span>＞中所描述。</p><p>從 Microsoft JDBC Driver 4.0 for SQL Server 開始，應用程式可以使用 <span sdata="langKeyword" value="authenticationScheme"><span class="keyword">authenticationScheme</span></span> 連接屬性來表示，它想要使用透過單純 Java Kerberos 實作的 Kerberos 整合式驗證連接到資料庫：</p><ul><li><p>如果您想要使用 <span sdata="langKeyword" value="Krb5LoginModule"><span class="keyword">Krb5LoginModule</span></span> 的整合式驗證，您依然必須指定 <span sdata="langKeyword" value="integratedSecurity=true"><span class="keyword">integratedSecurity=true</span></span> 連接屬性。然後您也會指定 <span sdata="langKeyword" value="authenticationScheme=JavaKerberos"><span class="keyword">authenticationScheme=JavaKerberos</span></span> 連接屬性。</p></li><li><p>若要繼續搭配 <span sdata="langKeyword" value="sqljdbc_auth.dll"><span class="keyword">sqljdbc_auth.dll</span></span> 使用整合式驗證，只需要指定 <span sdata="langKeyword" value="integratedSecurity=true"><span class="keyword">integratedSecurity=true</span></span> 連接屬性 (並可選擇指定 <span sdata="langKeyword" value="authenticationScheme=NativeAuthentication"><span class="keyword">authenticationScheme=NativeAuthentication</span></span>)。</p></li><li><p>如果您指定 <span sdata="langKeyword" value="authenticationScheme=JavaKerberos"><span class="keyword">authenticationScheme=JavaKerberos</span></span> 但是並未同時指定 <span sdata="langKeyword" value="integratedSecurity=true"><span class="keyword">integratedSecurity=true</span></span>，則驅動程式會忽略 <span sdata="langKeyword" value="authenticationScheme"><span class="keyword">authenticationScheme</span></span> 連接屬性，而且它預期能在連接字串中找到使用者名稱和密碼認證。</p></li></ul><p>當使用資料來源建立連接時，您可以使用 <a href="b942f78e-7ce1-44ef-923d-a7c3d7c76b83.htm">setAuthenticationScheme</a> 來以程式設計方式設定驗證配置。</p><p>已加入新的記錄器來支援 Kerberos 驗證：com.microsoft.sqlserver.jdbc.internals.KerbAuthentication。如需詳細資訊，請參閱＜<span sdata="link"><a href="723aeae7-6504-4585-ba8b-3525115bea8b.htm">追蹤驅動程式作業</a></span>＞。</p><p>以下指導方針可幫助您設定 Kerberos：</p><ol><li><p>在 Windows 的登錄中將 <span sdata="langKeyword" value="AllowTgtSessionKey"><span class="keyword">AllowTgtSessionKey</span></span> 設定為 1。如需詳細資訊，請參閱 <a href="http://support.microsoft.com/kb/837361">Windows Server 2003 中 Kerberos 通訊協定登錄項目與 KDC 組態金鑰</a>。</p></li><li><p>確定 Kerberos 組態 (UNIX 環境中的 krb5.conf) 指向您的環境所適用的正確領域和 KDC。</p></li><li><p>使用 kinit 或登入網域來初始化 TGT 快取。</p></li><li><p>當使用 <span sdata="langKeyword" value="authenticationScheme=JavaKerberos"><span class="keyword">authenticationScheme=JavaKerberos</span></span> 的應用程式在 Windows Vista 或 Windows 7 作業系統上執行時，您應該使用標準使用者帳戶。但是，如果您在系統管理員帳戶之下執行應用程式，則必須以系統管理員權限執行此應用程式。</p></li></ol></div><h1 class="heading">服務主要名稱</h1><div id="sectionSection1" class="section" name="collapseableSection" style=""><p>服務主要名稱 (SPN) 是用戶端唯一識別服務執行個體所依據的名稱。如需有關服務主要名稱 (SPN) 的詳細資訊，請參閱：</p><ul><li><p><a href="http://support.microsoft.com/kb/319723">如何在 SQL Server 中使用 Kerberos 驗證</a></p></li><li><p><a href="http://go.microsoft.com/fwlink/?LinkId=207814">搭配 SQL Server 使用 Kerberos</a></p></li></ul></div><h1 class="heading">建立登入模組組態檔</h1><div id="sectionSection2" class="section" name="collapseableSection" style=""><p>您可以選擇指定 Kerberos 組態檔。如果未指定組態檔，以下設定便有效：</p><dl class="authored"><dt>Sun JVM</dt><dd><p>com.sun.security.auth.module.Krb5LoginModule required useTicketCache=true doNotPrompt=true;</p></dd><dt>IBM JVM</dt><dd><p>com.ibm.security.auth.module.Krb5LoginModule required useDefaultCcache = true moduleBanner = false;</p></dd></dl><p>如果您決定建立登入模組組態檔，此檔案必須遵循以下格式：</p><div class="sampleCode"><span codeLanguage="other"><pre>&lt;<i>name</i>&gt; {
    &lt;<i>LoginModule</i>&gt; &lt;<i>flag</i>&gt; &lt;<i>LoginModule options</i>&gt;;
    &lt;<i>optional_additional_LoginModules</i>, <i>flags_and_options</i>&gt;;
};</pre></span></div><p>登入組態檔是由一個或多個項目組成，每一個項目都會指定哪一個基礎驗證技術應該用於特定應用程式。例如，</p><div class="sampleCode"><span codeLanguage="other"><pre>SQLJDBCDriver {
   com.sun.security.auth.module.Krb5LoginModule required useTicketCache=true doNotPrompt=true;
};</pre></span></div><p>所以每一個登入模組組態檔項目都是由一個名稱以及緊接在後的一個或多個 LoginModule-specific 項目所組成，其中每一個 LoginModule-specific 項目都是以分號結尾，而且整組 LoginModule-specific 項目會括在大括號中。每一個組態檔項目都是以分號結尾。</p><p>除了允許驅動程式使用登入模組組態檔中指定的設定來取得 Kerberos 認證以外，驅動程式也可以使用現有的認證。當您的應用程式需要使用一個以上的使用者認證來建立連接時，這樣的處理方式會很實用。</p><p>驅動程式會嘗試使用現有的認證 (如果可用的話)，然後再嘗試使用指定的登入模組進行登入。因此，當使用 Subject.doAs 方法在特定內容之下執行程式碼時，將會使用傳遞給 Subject.doAs 呼叫的認證來建立連接。</p><p>如需詳細資訊，請參閱 <a href="http://download.oracle.com/javase/1.4.2/docs/guide/security/jaas/tutorials/LoginConfigFile.html">JAAS 登入組態檔</a>和 <a href="http://download.oracle.com/javase/1.5.0/docs/guide/security/jgss/tutorials/KerberosReq.html">Krb5LoginModule 類別</a>。</p></div><h1 class="heading">建立 Kerberos 組態檔</h1><div id="sectionSection3" class="section" name="collapseableSection" style=""><p>如需有關 Kerberos 組態檔的詳細資訊，請參閱 <a href="http://download.oracle.com/javase/1.4.2/docs/guide/security/jaas/tutorials/LoginConfigFile.html">Kerberos 需求</a>。</p><p>這是網域組態檔範例，其中 YYYY 和 ZZZZ 是您網站的網域名稱。</p><div class="sampleCode"><span codeLanguage="other"><pre>[libdefaults]
default_realm = YYYY.CORP.CONTOSO.COM
dns_lookup_realm = false
dns_lookup_kdc = true
ticket_lifetime = 24h
forwardable = yes

[domain_realm]
.yyyy.corp.contoso.com = YYYY.CORP.CONTOSO.COM
.zzzz.corp.contoso.com = ZZZZ.CORP.CONTOSO.COM

[realms]
        YYYY.CORP.CONTOSO.COM = {
  kdc = krbtgt/YYYY.CORP. CONTOSO.COM @ YYYY.CORP. CONTOSO.COM
  default_domain = YYYY.CORP. CONTOSO.COM
}

        ZZZZ.CORP. CONTOSO.COM = {
  kdc = krbtgt/ZZZZ.CORP. CONTOSO.COM @ ZZZZ.CORP. CONTOSO.COM
  default_domain = ZZZZ.CORP. CONTOSO.COM
}
</pre></span></div></div><h1 class="heading">啟用網域組態檔和登入模組組態檔</h1><div id="sectionSection4" class="section" name="collapseableSection" style=""><p>您可以使用 Djava.security.krb5.conf 來啟用網域組態檔。您可以使用 <span sdata="langKeyword" value="-Djava.security.auth.login.config"><span class="keyword">-Djava.security.auth.login.config</span></span> 來啟用登入模組組態檔。</p><p>例如，當您啟動應用程式時，您可以使用這個命令列：</p><div class="sampleCode"><span codeLanguage="other"><pre>Java.exe -Djava.security.auth.login.config=SQLJDBCDriver.conf -Djava.security.krb5.conf=krb5.ini &lt;<i>APPLICATION_NAME</i>&gt;
</pre></span></div></div><h1 class="heading">確認可以透過 Kerberos 存取 SQL Server</h1><div id="sectionSection5" class="section" name="collapseableSection" style=""><p>在 SQL Server Management Studio 中執行以下查詢：</p><p><span sdata="langKeyword" value="select auth_scheme from sys.dm_exec_connections where session_id=@@spid"><span class="keyword">select auth_scheme from sys.dm_exec_connections where session_id=@@spid</span></span></p><p>確定您擁有執行這個查詢的必要權限。</p></div><span id="seeAlsoSpan"><h1 class="heading">請參閱</h1></span><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><div class="seeAlsoStyle"><span sdata="link"><a href="94bcfbe3-f00e-4774-bda8-bb7577518fec.htm">使用 JDBC 驅動程式連接到 SQL Server</a></span></div></div></div><div id="footer" class="section"><span id="feedbackarea">將有關本主題的<a href="javascript:SubmitFeedback('DevDocs@Microsoft.com','','','','8.0.12060.10000','%0\d感謝您的意見反應。開發人員撰寫小組會使用您的意見反應改善文件集。檢閱意見反應的同時，我們可能會傳送電子郵件給您要求提供進一步說明或是解決方案的意見。電子郵件地址不會用於任何其他目的，檢閱後將會刪除。%0\A如需有關%20Microsoft%20隱私權原則的詳細資訊，請參閱%20http://privacy.microsoft.com/zh-tw/default.aspx。%0\A%0\d','客戶回函');">意見反應</a>傳送給 Microsoft。</span><span id="copyrightarea"><p><a href="9bad553b-9e70-4696-8499-2e35f772a1e0.htm">© 2012 Microsoft.著作權所有，並保留一切權利。</a></p></span></div></div></body></html>