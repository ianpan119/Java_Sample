<html xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:mshelp="http://msdn.microsoft.com/mshelp" xmlns:ddue="http://ddue.schemas.microsoft.com/authoring/2003/5" xmlns:msxsl="urn:schemas-microsoft-com:xslt"><head><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8" /><META NAME="save" CONTENT="history" /><title>執行批次作業</title><meta name="Language" content="zh-cht" /><meta name="System.Keywords" content="批次作業" /><meta name="Microsoft.Help.Id" content="1a576d95-7da6-4b7b-8b32-59e5b4d354c4" /><meta name="Description" content="在對 SQL Server 資料庫進行多重更新時，為了改進效能，Microsoft JDBC Driver for SQL Server 提供以單一工作單位提交多重更新的功能，這也稱為批次。" /><meta name="Microsoft.Help.ContentType" content="Concepts" /><link rel="stylesheet" type="text/css" href="../local/Classic.css" /><script type="text/javascript" src="../scripts/EventUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/SplitScreen.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/Dropdown.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_manifold.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/script_feedBack.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CheckboxMenu.js">&amp;nbsp;</script><script type="text/javascript" src="../scripts/CommonUtilities.js">&amp;nbsp;</script><script type="text/javascript" src="../local/script_main.js">&amp;nbsp;</script></head><body><div id="header"><table id="bottomTable" cellpadding="0" cellspacing="0"><tr><td align="left"><span id="headerBold">執行批次作業</span></td></tr></table><table id="gradientTable"><tr><td class="nsrBottom" background="../icons/gradient.gif" /></tr></table></div><div id="mainSection"><div id="mainBody"><div class="introduction"><p>在對 SQL Server 資料庫進行多重更新時，為了改進效能，Microsoft JDBC Driver for SQL Server 提供以單一工作單位提交多重更新的功能，這也稱為批次。</p><p><a href="ec24963c-8b51-4838-91e9-1fbfa2347451.htm">SQLServerStatement</a>、<a href="a8481c06-fbba-432b-8c69-4f4619c20ad4.htm">SQLServerPreparedStatement</a> 和 <a href="30710a63-c05d-47d9-9cf9-c087a1c76373.htm">SQLServerCallableStatement</a> 類別都可以用來提交批次更新。<a href="134f1455-c98c-4112-ab2d-9205a0db73df.htm">addBatch</a> 方法是用來加入命令。<a href="6e5cda26-e24d-4637-8dfd-8135ba126e3b.htm">clearBatch</a> 方法是用來清除命令清單。<a href="fb034f63-2532-4da8-a1b0-bc125734585a.htm">executeBatch</a> 方法是用來提交所有命令以供處理。只有傳回簡單更新計數的資料定義語言 (DDL) 和資料操作語言 (DML) 陳述式可以當作批次的一部份來執行。</p><p><b>executeBatch</b> 方法會傳回對應到每個命令之更新計數的 <span sdata="langKeyword" value="int"><span class="keyword">int</span></span> 值陣列。如果其中一個命令失敗，會發生 <b>BatchUpdateException</b>，且您應該使用 <b>BatchUpdateException</b> 類別的 <b>getUpdateCounts</b> 方法來擷取更新計數陣列。如果某命令失敗，驅動程式會繼續處理其餘命令。不過，如果命令有語法錯誤，批次中的陳述式會失敗。</p><div style="margin: .5em 1.5em .5em 1.5em"><b></b><p>如果不必使用更新計數，可以先對 SQL Server 發出 SET NOCOUNT ON 陳述式。這將會減少網路流量，而且還會加強應用程式的效能。</p></div><p>例如，在 SQL Server 2005 AdventureWorks 範例資料庫中建立下列資料表：</p><div class="sampleCode"><span codeLanguage="other"><pre>CREATE TABLE TestTable 
   (Col1 int IDENTITY, 
    Col2 varchar(50), 
    Col3 int);</pre></span></div><p>在下列範例中，連至 AdventureWorks 範例資料庫的開啟連接會傳遞至函數中，會使用 <b>addBatch</b> 方法來建立要執行的陳述式，並呼叫 <b>executeBatch</b> 方法，將批次送出至資料庫。</p><div class="sampleCode"><span codeLanguage="other"><pre>public static void executeBatchUpdate(Connection con) {
   try {
      Statement stmt = con.createStatement();
      stmt.addBatch("INSERT INTO TestTable (Col2, Col3) VALUES ('X', 100)");
      stmt.addBatch("INSERT INTO TestTable (Col2, Col3) VALUES ('Y', 200)");
      stmt.addBatch("INSERT INTO TestTable (Col2, Col3) VALUES ('Z', 300)");
      int[] updateCounts = stmt.executeBatch();
      stmt.close();
   }
   catch (Exception e) {
      e.printStackTrace();
   }
}</pre></span></div></div><span id="seeAlsoSpan"><h1 class="heading">請參閱</h1></span><div id="seeAlsoSection" class="section" name="collapseableSection" style=""><div class="seeAlsoStyle"><span sdata="link"><a href="7f8f3e8f-841e-4449-9154-b5366870121f.htm">搭配 JDBC Driver 使用陳述式</a></span></div></div></div><div id="footer" class="section"><span id="feedbackarea">將有關本主題的<a href="javascript:SubmitFeedback('DevDocs@Microsoft.com','','','','8.0.12060.10000','%0\d感謝您的意見反應。開發人員撰寫小組會使用您的意見反應改善文件集。檢閱意見反應的同時，我們可能會傳送電子郵件給您要求提供進一步說明或是解決方案的意見。電子郵件地址不會用於任何其他目的，檢閱後將會刪除。%0\A如需有關%20Microsoft%20隱私權原則的詳細資訊，請參閱%20http://privacy.microsoft.com/zh-tw/default.aspx。%0\A%0\d','客戶回函');">意見反應</a>傳送給 Microsoft。</span><span id="copyrightarea"><p><a href="9bad553b-9e70-4696-8499-2e35f772a1e0.htm">© 2012 Microsoft.著作權所有，並保留一切權利。</a></p></span></div></div></body></html>